<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPF Viewer Test Harness</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #0078d4;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: inline-block;
            width: 180px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .control-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 200px;
            background: white;
        }

        .control-group input[type="color"] {
            width: 60px;
            height: 36px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .color-inputs {
            display: inline-flex;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .color-input small {
            font-size: 11px;
            color: #666;
        }

        button {
            background: #0078d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-right: 10px;
        }

        button:hover {
            background: #106ebe;
        }

        button.secondary {
            background: #f3f2f1;
            color: #323130;
        }

        button.secondary:hover {
            background: #e1dfdd;
        }

        .viewer-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        #pcf-control {
            width: 100%;
        }

        .info {
            background: #f0f6ff;
            border-left: 4px solid #0078d4;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info h3 {
            color: #0078d4;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .info ul {
            margin-left: 20px;
            color: #333;
        }

        .info li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”„ Business Process Flow Viewer - Test Harness</h1>
        <p class="subtitle">Test all 6 design styles with mock data</p>

        <div class="info">
            <h3>ðŸ“Š Mock Data Loaded</h3>
            <ul>
                <li><strong>8 records</strong> with various BPF states (3 opportunities, 1 lead, 1 case, 1 no BPF, 1 loading example)</li>
                <li><strong>3 design variations</strong>: Opportunities (4 stages), Leads (3 stages), Cases (3 stages)</li>
                <li>All 6 visual designs available for testing</li>
            </ul>
        </div>

        <div class="controls">
            <h3 style="margin-bottom: 15px; color: #333;">Control Settings</h3>

            <div class="control-group">
                <label for="designStyle">Design Style:</label>
                <select id="designStyle" onchange="updateControl()">
                    <option value="chevron">Chevron (Classic Arrows)</option>
                    <option value="circles">Circles (Connected Dots)</option>
                    <option value="pills">Pills (Rounded Badges)</option>
                    <option value="segmented">Segmented (Progress Bar)</option>
                    <option value="timeline">Timeline (Horizontal Flow)</option>
                    <option value="stepper">Stepper (Numbered Boxes)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="displayMode">Display Mode:</label>
                <select id="displayMode" onchange="updateControl()">
                    <option value="stage">Stage Name</option>
                    <option value="category">Stage Category</option>
                </select>
            </div>

            <div class="control-group">
                <label for="recordNameSize">Record Name Size:</label>
                <select id="recordNameSize" onchange="updateControl()">
                    <option value="small">Small</option>
                    <option value="medium" selected>Medium</option>
                    <option value="large">Large</option>
                </select>
            </div>

            <div class="control-group">
                <label for="showEntityName">Show Entity Name:</label>
                <select id="showEntityName" onchange="updateControl()">
                    <option value="yes" selected>Yes</option>
                    <option value="no">No</option>
                </select>
            </div>

            <div class="control-group">
                <label for="enableNavigation">Enable Navigation:</label>
                <select id="enableNavigation" onchange="updateControl()">
                    <option value="yes" selected>Yes</option>
                    <option value="no">No</option>
                </select>
            </div>

            <div class="control-group">
                <label for="showPulse">Show Pulse Animation:</label>
                <select id="showPulse" onchange="updateControl()">
                    <option value="yes" selected>Yes</option>
                    <option value="no">No</option>
                </select>
            </div>

            <div class="control-group">
                <label for="usePlatformTheme">Use Platform Theme:</label>
                <select id="usePlatformTheme" onchange="toggleCustomColors(); updateControl()">
                    <option value="yes" selected>Yes (Fluent UI)</option>
                    <option value="no">No (Custom Colors)</option>
                </select>
            </div>

            <div id="customColors" style="display: none;">
                <div class="control-group">
                    <label>Custom Colors:</label>
                    <div class="color-inputs">
                        <div class="color-input">
                            <small>Completed</small>
                            <input type="color" id="completedColor" value="#107C10" onchange="updateControl()">
                        </div>
                        <div class="color-input">
                            <small>Completed Text</small>
                            <input type="color" id="completedTextColor" value="#FFFFFF" onchange="updateControl()">
                        </div>
                        <div class="color-input">
                            <small>Active</small>
                            <input type="color" id="activeColor" value="#0078D4" onchange="updateControl()">
                        </div>
                        <div class="color-input">
                            <small>Active Text</small>
                            <input type="color" id="activeTextColor" value="#FFFFFF" onchange="updateControl()">
                        </div>
                        <div class="color-input">
                            <small>Inactive</small>
                            <input type="color" id="inactiveColor" value="#E1E1E1" onchange="updateControl()">
                        </div>
                        <div class="color-input">
                            <small>Inactive Text</small>
                            <input type="color" id="inactiveTextColor" value="#666666" onchange="updateControl()">
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <button onclick="updateControl()">Refresh Control</button>
                <button class="secondary" onclick="resetSettings()">Reset to Defaults</button>
            </div>
        </div>

        <div class="viewer-container">
            <div id="pcf-control"></div>
        </div>
    </div>

    <script src="out/controls/bundle.js"></script>
    <script type="module">
        import { MOCK_RECORDS, MOCK_BPF_CONFIG, MockDataset, MockWebAPI, MockNavigation } from './out/mocks/index.js';

        // Make available globally
        window.MOCK_RECORDS = MOCK_RECORDS;
        window.MOCK_BPF_CONFIG = MOCK_BPF_CONFIG;
        window.MockDataset = MockDataset;
        window.MockWebAPI = MockWebAPI;
        window.MockNavigation = MockNavigation;

        // Initialize control
        window.addEventListener('load', () => {
            setTimeout(() => {
                window.initializeControl();
            }, 100);
        });
    </script>
    <script>
        function toggleCustomColors() {
            const usePlatform = document.getElementById('usePlatformTheme').value === 'yes';
            document.getElementById('customColors').style.display = usePlatform ? 'none' : 'block';
        }

        function resetSettings() {
            document.getElementById('designStyle').value = 'chevron';
            document.getElementById('displayMode').value = 'stage';
            document.getElementById('recordNameSize').value = 'medium';
            document.getElementById('showEntityName').value = 'yes';
            document.getElementById('enableNavigation').value = 'yes';
            document.getElementById('showPulse').value = 'yes';
            document.getElementById('usePlatformTheme').value = 'yes';
            toggleCustomColors();
            updateControl();
        }

        let controlInstance = null;

        function initializeControl() {
            if (!window.AllanDeCastro || !window.MOCK_RECORDS) {
                console.error('Control or mock data not loaded yet');
                setTimeout(initializeControl, 100);
                return;
            }

            const container = document.getElementById('pcf-control');
            container.innerHTML = '';

            // Create mock context
            const mockDataset = new window.MockDataset();
            const mockWebAPI = new window.MockWebAPI();
            const mockNavigation = new window.MockNavigation();

            const mockContext = {
                parameters: {
                    parametersBPF: {
                        raw: JSON.stringify(window.MOCK_BPF_CONFIG),
                        type: 'SingleLine.Text'
                    },
                    designStyle: {
                        raw: document.getElementById('designStyle').value,
                        type: 'Enum'
                    },
                    displayMode: {
                        raw: document.getElementById('displayMode').value,
                        type: 'Enum'
                    },
                    recordNameSize: {
                        raw: document.getElementById('recordNameSize').value,
                        type: 'Enum'
                    },
                    showEntityName: {
                        raw: document.getElementById('showEntityName').value,
                        type: 'Enum'
                    },
                    enableNavigation: {
                        raw: document.getElementById('enableNavigation').value,
                        type: 'Enum'
                    },
                    showPulseAnimation: {
                        raw: document.getElementById('showPulse').value,
                        type: 'Enum'
                    },
                    usePlatformTheme: {
                        raw: document.getElementById('usePlatformTheme').value,
                        type: 'Enum'
                    },
                    completedColor: {
                        raw: document.getElementById('completedColor').value,
                        type: 'SingleLine.Text'
                    },
                    completedTextColor: {
                        raw: document.getElementById('completedTextColor').value,
                        type: 'SingleLine.Text'
                    },
                    activeColor: {
                        raw: document.getElementById('activeColor').value,
                        type: 'SingleLine.Text'
                    },
                    activeTextColor: {
                        raw: document.getElementById('activeTextColor').value,
                        type: 'SingleLine.Text'
                    },
                    inactiveColor: {
                        raw: document.getElementById('inactiveColor').value,
                        type: 'SingleLine.Text'
                    },
                    inactiveTextColor: {
                        raw: document.getElementById('inactiveTextColor').value,
                        type: 'SingleLine.Text'
                    },
                    records: mockDataset
                },
                mode: {
                    trackContainerResize: () => {}
                },
                webAPI: mockWebAPI,
                navigation: mockNavigation,
                fluentDesignLanguage: null
            };

            // Initialize control
            try {
                controlInstance = new window.AllanDeCastro.BusinessProcessFlowViewer();
                controlInstance.init(mockContext, () => {});

                // Render control
                const reactElement = controlInstance.updateView(mockContext);

                // Use React to render
                if (window.React && window.ReactDOM) {
                    window.ReactDOM.render(reactElement, container);
                } else {
                    console.error('React not loaded');
                }

                console.log('âœ… Control initialized successfully');
            } catch (error) {
                console.error('Failed to initialize control:', error);
                container.innerHTML = `<div style="color: red; padding: 20px;">
                    <strong>Error loading control:</strong><br>
                    ${error.message}
                </div>`;
            }
        }

        function updateControl() {
            initializeControl();
        }

        // Export for global access
        window.initializeControl = initializeControl;
        window.updateControl = updateControl;
    </script>
</body>
</html>
